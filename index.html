<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Evita los bloques - Arcade</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Press Start 2P', monospace;
      background: #000;
      color: #0ff;
    }
    canvas {
      display: none;
      margin: auto;
      background: linear-gradient(#111, #000);
      box-shadow: 0 0 20px #0ff, inset 0 0 10px #0ff;
      image-rendering: pixelated;
      position: relative;
    }
    canvas::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,0.2),
        rgba(0,0,0,0.2) 2px,
        transparent 2px,
        transparent 4px
      );
      pointer-events: none;
    }
    #overlay, #pauseMenu, #controlsPopup {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      backdrop-filter: blur(2px);
      background: rgba(0,0,0,0.8);
      display: flex; justify-content: center; align-items: center;
      flex-direction: column;
      z-index: 2;
    }
    #overlay h1 {
      font-size: 24px; color: #0ff;
      text-shadow: 0 0 10px #0ff;
      margin-bottom: 20px;
    }
    #overlay input, #overlay button, #pauseMenu button {
      padding: 10px 20px;
      font-size: 14px;
      border: none; border-radius: 4px;
      margin: 8px; background: #0ff; color: #000;
      cursor: pointer; box-shadow: 0 0 5px #0ff;
    }
    #pauseMenu { display: none; z-index: 3; }
    #pauseMenu h2 { font-size: 20px; color: white; margin-bottom: 10px; }
    #pauseMenu p { font-size: 12px; color: #0ff; }
    #controlsPopup { display: none; z-index: 4; text-align: center; padding: 20px; }
    #controlsPopup h3 { font-size: 16px; margin-bottom: 10px; }
    #controlsPopup ul { list-style: none; padding: 0; font-size: 12px; }
    #controlsPopup button { margin-top: 20px; }
  </style>
</head>
<body>
  <div id="overlay">
    <h1>üïπÔ∏è EVITA LOS BLOQUES</h1>
    <input id="codeInput" placeholder="C√≥digo de guardado">
    <button onclick="startGame()">Jugar</button>
    <button onclick="loadProgress()">Cargar progreso</button>
    <button onclick="showControls()">üéÆ Controles</button>
  </div>

  <div id="controlsPopup">
    <h3>Controles del juego</h3>
    <ul>
      <li>‚Üê / A : Mover a la izquierda</li>
      <li>‚Üí / D : Mover a la derecha</li>
      <li>P o Esc : Pausar el juego</li>
      <li>Enter : Reiniciar tras Game Over</li>
      <li>Recoge monedas doradas üí∞</li>
      <li>Bloques verdes ‚ù§Ô∏è = vida extra</li>
      <li>Evita los rojos ‚ùå y bombas üí£</li>
      <li>‚ùì Sorpresas = efecto aleatorio</li>
      <li>üî• 5 monedas seguidas = modo furia</li>
    </ul>
    <button onclick="hideControls()">Cerrar</button>
  </div>

  <div id="pauseMenu">
    <h2>PAUSA</h2>
    <p id="saveCode">C√≥digo de guardado:</p>
    <p id="coinCount">Monedas: 0</p>
    <button onclick="buySpeed()">Mejorar velocidad (Costo: <span id="speedCost">5</span>)</button>
    <button onclick="buyLife()">Comprar vida (Costo: <span id="lifeCost">5</span>)</button>
    <button onclick="returnToMenu()">Volver al inicio</button>
  </div>

  <canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 180, y: 550, width: 40, height: 40, speed: 7 };
let obstacles = [];
let stars = [];
let score = 0, lives = 3, coins = 0;
let gameOver = false, paused = false, gameStarted = false;
let obstacleSpeed = 4;
let furyActive = false, furyTimer = 0, coinStreak = 0;

// üéµ Sonidos retro
const sounds = {
  music: new Audio("https://files.catbox.moe/w1jok0.mp3"), // M√∫sica de fondo
  coin: new Audio("https://files.catbox.moe/ivv2uy.wav"),
  life: new Audio("https://files.catbox.moe/d38sc5.wav"),
  hit: new Audio("https://files.catbox.moe/0vz9h6.wav"),
  power: new Audio("https://files.catbox.moe/q6bd7m.wav")
};
sounds.music.loop = true;
sounds.music.volume = 0.5;

// === üé® Dibujos arcade de bloques ===
function drawBlock(obs) {
  ctx.save();
  ctx.fillStyle = obs.color;
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 2;
  ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
  ctx.strokeRect(obs.x, obs.y, obs.width, obs.height);

  ctx.fillStyle = "#fff";
  ctx.font = "20px Press Start 2P";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  let symbol = "";
  if (obs.type === "danger") symbol = "‚ùå";
  if (obs.type === "life") symbol = "‚ù§Ô∏è";
  if (obs.type === "coin") symbol = "üí∞";
  if (obs.type === "bomb") symbol = "üí£";
  if (obs.type === "surprise") symbol = "?";

  ctx.fillText(symbol, obs.x + obs.width/2, obs.y + obs.height/2 + 2);
  ctx.restore();
}

// === Inicializar estrellas de fondo ===
function initStars() {
  stars = Array.from({ length: 50 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    size: Math.random() * 2 + 1
  }));
}

function drawStars() {
  ctx.fillStyle = '#0ff';
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.size, 0, Math.PI*2);
    ctx.fill();
    star.y += 0.5;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  });
}

function startGame() {
  document.getElementById("overlay").style.display = "none";
  canvas.style.display = "block";
  gameStarted = true;
  paused = false;
  gameOver = false;
  score = 0; lives = 3; coins = 0;
  obstacleSpeed = 4; furyActive = false; coinStreak = 0;
  initStars();
  sounds.music.play();
  update();
}

// Generar bloques
function updateObstacles() {
  obstacles.forEach(obs => obs.y += obstacleSpeed);
  obstacles = obstacles.filter(obs => obs.y < canvas.height);

  if (Math.random() < 0.03) {
    const rand = Math.random();
    let type = "danger", color = "red";
    if (rand < 0.05) { type = "life"; color = "green"; }
    else if (rand < 0.08) { type = "coin"; color = "gold"; }
    else if (rand < 0.10) { type = "bomb"; color = "black"; }
    else if (rand < 0.12) { type = "surprise"; color = "orange"; }
    obstacles.push({ x: Math.random()*(canvas.width-40), y: 0, width: 40, height: 40, type, color });
  }
}

// === Dibujar jugador ===
function drawPlayer() {
  ctx.fillStyle = furyActive ? "yellow" : "lime";
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

// === HUD ===
function drawHUD() {
  ctx.fillStyle = "#0ff";
  ctx.font = "12px Press Start 2P";
  ctx.fillText(`Puntos: ${score}`, 10, 20);
  ctx.fillText(`Vidas: ${lives}`, 10, 40);
  ctx.fillText(`Monedas: ${coins}`, 10, 60);
  if (furyActive) ctx.fillText("üî• FURIA!", 250, 20);
}

// === Colisiones ===
function checkCollision() {
  obstacles.forEach((obs, i) => {
    if (
      player.x < obs.x + obs.width &&
      player.x + player.width > obs.x &&
      player.y < obs.y + obs.height &&
      player.y + player.height > obs.y
    ) {
      if (obs.type === "danger") { lives--; sounds.hit.play(); }
      if (obs.type === "life") { lives++; sounds.life.play(); }
      if (obs.type === "coin") {
        coins++; coinStreak++; sounds.coin.play();
        if (coinStreak >= 5 && !furyActive) {
          furyActive = true; furyTimer = 300;
          player.speed += 3; sounds.power.play();
        }
      }
      if (obs.type === "bomb") { lives--; sounds.hit.play(); }
      if (obs.type === "surprise") {
        const effects = ["life","coin","danger"];
        const effect = effects[Math.floor(Math.random()*effects.length)];
        if (effect==="life"){lives++;sounds.life.play();}
        if (effect==="coin"){coins++;sounds.coin.play();}
        if (effect==="danger"){lives--;sounds.hit.play();}
      }
      obstacles.splice(i,1);
    }
  });
  if (lives <= 0) gameOver = true;
}

// === Loop principal ===
function update() {
  if (paused || gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawStars();
  drawPlayer();
  obstacles.forEach(drawBlock);
  drawHUD();
  updateObstacles();
  checkCollision();
  if (furyActive) {
    furyTimer--;
    if (furyTimer<=0){ furyActive=false; player.speed-=3; }
  }
  score += furyActive ? 2 : 1;
  requestAnimationFrame(update);
}

document.addEventListener("keydown", e => {
  if ((e.key === "ArrowLeft" || e.key === "a") && player.x > 0) player.x -= player.speed;
  if ((e.key === "ArrowRight" || e.key === "d") && player.x + player.width < canvas.width) player.x += player.speed;
});
</script>
</body>
</html>
